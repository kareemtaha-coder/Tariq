<section class="testimonials-section relative overflow-hidden absolute inset-0 bg-gradient-to-br from-gray-50/90 to-white dark:from-gray-900/95 dark:to-gray-950">
  <!-- Decorative Background Elements -->
  <div class="absolute inset-0 z-0 pointer-events-none">
    <div class="grid-pattern"></div>
    <div class="orb orb-primary absolute top-0 right-0 opacity-20 transform translate-x-1/4 -translate-y-1/4"></div>
    <div class="orb orb-secondary absolute bottom-0 left-0 opacity-20 transform -translate-x-1/4 translate-y-1/4"></div>
  </div>

  <div class="container mx-auto px-4 relative z-10 py-8 sm:py-10 lg:py-12">
    <!-- Section Header -->
    <div class="text-center max-w-2xl mx-auto mb-6 sm:mb-8">
      <span class="text-xs font-medium tracking-wider uppercase text-primary dark:text-primary-light mb-2 inline-block">Student Experiences</span>
      <h2 class="text-2xl sm:text-3xl font-bold text-gray-900 dark:text-white mb-2">
        <span class="bg-clip-text text-transparent bg-gradient-to-r from-primary to-secondary">What Our Students Say</span>
      </h2>
      <p class="text-sm text-gray-600 dark:text-gray-300 max-w-xl mx-auto">
        Discover how Tabiiyn Institute has helped students achieve their learning goals
      </p>
    </div>

    <!-- Main Content Area -->
    <div class="flex flex-col md:flex-row md:items-start gap-6 md:gap-10">
      <!-- Main Testimonial Slider -->
      <div class="testimonial-main-swiper w-full md:w-3/5">
        <swiper-container #mainContainer class="w-full" init="false">
          <swiper-slide *ngFor="let testimonial of testimonials; let i = index">
            <div class="testimonial-card h-full">
              <div class="testimonial-card-inner shadow-md dark:shadow-gray-900/30 h-full">
                <!-- Content Structure -->
                <div class="testimonial-content p-4 sm:p-6 flex flex-col h-full">
                  <!-- Student Info -->
                  <div class="flex items-center mb-4">
                    <div class="student-avatar w-10 h-10 sm:w-12 sm:h-12 ring-2 ring-primary ring-offset-2 dark:ring-offset-gray-800">
                      <img [src]="testimonial.avatar" [alt]="testimonial.name" loading="lazy">
                    </div>
                    <div class="ml-3">
                      <div class="flex flex-wrap items-center gap-2">
                        <h3 class="text-sm sm:text-base font-bold text-gray-900 dark:text-white">{{ testimonial.name }}</h3>
                        <span class="text-xs text-primary dark:text-primary-light px-2 py-0.5 bg-primary/10 dark:bg-primary/20 rounded-full">{{ testimonial.course }}</span>
                      </div>
                      <div class="rating">
                        <ng-container *ngFor="let star of [1,2,3,4,5]">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 star" [class.opacity-50]="star > parseFloat(testimonial.rating)">
                            <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z" clip-rule="evenodd" />
                          </svg>
                        </ng-container>
                      </div>
                    </div>
                  </div>

                  <!-- Quote Content -->
                  <div class="flex-grow">
                    <p class="text-sm font-medium text-primary dark:text-primary-light italic mb-2">
                      "{{ testimonial.shortQuote }}"
                    </p>
                    <p class="text-sm text-gray-600 dark:text-gray-300" [class.line-clamp-3]="!isViewingDetails()">
                      "{{ testimonial.mainQuote }}"
                    </p>
                  </div>

                  <!-- Read Toggle -->
                  <button class="text-xs text-primary hover:text-primary-dark dark:hover:text-primary-light mt-3 flex items-center self-start transition-colors duration-200" (click)="isViewingDetails() ? closeDetails() : viewDetails()">
                    {{ isViewingDetails() ? "Show Less" : "Read More" }}
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-3 h-3 ml-1 transition-transform duration-200" [class.rotate-180]="isViewingDetails()">
                      <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
          </swiper-slide>
        </swiper-container>
      </div>

      <!-- Right Column -->
      <div class="w-full md:w-2/5 flex flex-col">
        <!-- Stats -->
        <div class="grid grid-cols-2 gap-4 mb-6">
          <div class="text-center p-4 bg-white/90 dark:bg-gray-800/90 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
            <div class="text-xl sm:text-2xl font-bold text-primary">98%</div>
            <div class="text-xs text-gray-600 dark:text-gray-300">Student Satisfaction</div>
          </div>
          <div class="text-center p-4 bg-white/90 dark:bg-gray-800/90 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
            <div class="text-xl sm:text-2xl font-bold text-primary">4.9</div>
            <div class="text-xs text-gray-600 dark:text-gray-300">Average Rating</div>
          </div>
        </div>

        <!-- Thumbnails Navigation -->
        <div class="mb-6 bg-white/50 dark:bg-gray-800/50 p-3 rounded-lg shadow-sm border border-gray-100 dark:border-gray-700">
          <p class="text-xs text-gray-500 dark:text-gray-400 mb-2 text-center">Meet our students</p>
          <div class="testimonial-thumbs-swiper">
            <swiper-container #thumbsContainer class="w-full" init="false">
              <swiper-slide *ngFor="let testimonial of testimonials; let i = index">
                <div
                  class="thumb-item w-10 h-10 sm:w-12 sm:h-12"
                  [class.active]="currentIndex() === i"
                  (click)="goToTestimonial(i)">
                  <img [src]="testimonial.avatar" [alt]="testimonial.name" loading="lazy">
                </div>
              </swiper-slide>
            </swiper-container>
          </div>
        </div>

        <!-- Navigation -->
        <div class="flex justify-center items-center mb-6">
          <button class="p-2 mx-2 text-primary hover:bg-primary/10 rounded-full focus:outline-none focus:ring-2 focus:ring-primary/20 transition-colors duration-200" (click)="prevSlide('main')" aria-label="Previous testimonial">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
          </button>
          <div class="text-xs text-gray-500 dark:text-gray-400 mx-2">
            {{ currentIndex() + 1 }} / {{ testimonials.length }}
          </div>
          <button class="p-2 mx-2 text-primary hover:bg-primary/10 rounded-full focus:outline-none focus:ring-2 focus:ring-primary/20 transition-colors duration-200" (click)="nextSlide('main')" aria-label="Next testimonial">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
            </svg>
          </button>
        </div>

        <!-- CTA Button -->
        <button class="cta-button py-3 px-6 w-full text-sm font-medium rounded-md shadow transition-all duration-300" (click)="scheduleFreeTrial()">
          Schedule Your Free Consultation
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" />
          </svg>
        </button>
      </div>
    </div>
  </div>
</section>

<ng-template #contactModal>
  <app-contact-form-modal></app-contact-form-modal>
</ng-template>
